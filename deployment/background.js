/*!
 * @license
 *  - This file is part of Craigslist Helper chrome extension
 *  - Copyright (C) 2020 DaniS Software
 *  - Chrome Extension to update and repost expired Craigslist listing in bulk
 * 
 */!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t,n){"use strict";n.r(t),n.d(t,"KEY_ALL_LISTINGS",(function(){return o})),n.d(t,"KEY_NEVERSHOW_LISTINGS",(function(){return r})),n.d(t,"KEY_CURRENT_LISTING",(function(){return a})),n.d(t,"KEY_COMPLETED_POSTING",(function(){return s})),n.d(t,"message_origin",(function(){return i})),n.d(t,"message_destination",(function(){return l})),n.d(t,"message_type",(function(){return c}));var o="craigslist_relister_renew_listings",r="craigslist_relister_nevershow_listings",a="craigslist_relister_current_listing",s="craigslist_relister_completed_posting",i={POPUP:"popup",BACKGROUND:"background",CONTENT:"content_script"},l={CONTENT:"content",BACKGROUND:"background"};const c={RENEW:"renew_listing",GET_LISTINGS:"get_listings",GET_NEVER_SHOW:"get_nevershow_listings",CLEAR_NEVER_SHOW_LISTINGS:"clear_nevershown_listings",RESET_AND_INTERRUPT_POSTER:"reset_and_interput_poster",REPROCESS_LISTINGS:"reprocess_listings"}},function(e,t,n){"use strict";n.r(t),n.d(t,"SyncStorage",(function(){return o}));var o={save:function(e,t){return new Promise((n,o)=>{t||o("Error: No value specified");var r=new Object;r[e]=t,chrome.storage.local.set(r,(function(){console.log("We have saved all the settings!!! WohOOO"),n("Settings saved")}))})},get:function(e){return new Promise((t,n)=>{chrome.storage.local.get(e,(function(e){t(e.sKey)}))})},removeAll:function(){chrome.storage.local.clear()},remove:function(e){return new Promise((t,n)=>{chrome.storage.local.remove(e,()=>{t()})})},getAll:function(e){return new Promise((e,t)=>{chrome.storage.local.get(null,(function(t){e(t)}))})},getSize:function(){return new Promise((e,t)=>{chrome.storage.local.getBytesInUse(null,t=>{e(t)})})},subscribeToChanges:function(){return new Promise((e,t)=>{chrome.storage.onChanged.addListener((t,n)=>{e(t)})})}}},,function(e,t,n){var o=n(0),r=n(1);function a(e,t,n){var o=/((http)(s)?:\/\/)?(accounts|post).craigslist.org\/.*/;chrome.tabs.query({active:!0,currentWindow:!0},(function(e){var t=e[0];s(t)?t.url.search(o)>-1?chrome.browserAction.setIcon({path:"icon.png"}):chrome.browserAction.setIcon({path:"icon_greyed_out.png"}):chrome.browserAction.setIcon({path:"icon_greyed_out.png"})}))}function s(e){return!(void 0===e||!e)}function i(e,t,n,o,r,a){chrome.tabs.sendMessage(e,{from:n,to:o,type:t,value:r},a)}async function l(e,t){var n=null;n=await r.SyncStorage.get(o.KEY_NEVERSHOW_LISTINGS),s(e)&&e.length>0&&(s(n)&&n.data.length>0?(console.log("Detected existing never show listing data.  Appending new data to the existing data"),Array.prototype.push.apply(n.data,e)):n={dateCreated:Date.now(),dateAccessed:Date.now(),data:e},r.SyncStorage.save(o.KEY_NEVERSHOW_LISTINGS,n).then(()=>{console.log("Stored never show listings data")}))}chrome.runtime.onMessage.addListener((async function(e,t,n){if(console.log("get some message in the background"),e.to===o.message_destination.BACKGROUND)if(console.log(t.tab?"from a content script:"+t.tab.url:"from the extension"),e.from===o.message_origin.POPUP){if(e.type===o.message_type.CLEAR_NEVER_SHOW_LISTINGS)SyncStorage.remove(KEY_NEVERSHOW_LISTINGS);else if(e.type===o.message_type.RESET_AND_INTERRUPT_POSTER)console.log("Deleting KEY_ALL_LISTINGS and KEY_CURRENT_LISTING"),Promise.allSettled([r.SyncStorage.remove(o.KEY_ALL_LISTINGS),r.SyncStorage.remove(o.KEY_CURRENT_LISTING)]);else if(e.type===o.message_type.REPROCESS_LISTINGS)s(e.value.payload.nevershow)&&e.value.payload.nevershow.length>0&&await l(e.value.payload.nevershow);else if(e.type===o.message_type.RENEW){if(!s(e.value.payload))return void console.log("No payload information detected");var a=e.value.active_tab;if(console.log("received message from POPUP"),console.log(e.value.payload),chrome.storage.local.clear(()=>{}),c={dateCreated:Date.now(),dateAccessed:Date.now(),data:e.value.payload.renew},await l(e.value.payload.nevershow),null!=e.value.payload&&null!=e.value.payload.renew&&e.value.payload.renew.length>0){var c=null;c={dateCreated:Date.now(),dateAccessed:Date.now(),data:e.value.payload.renew},r.SyncStorage.save(KEY_ALL_LISTINGS,c).then(()=>{console.log("Stored the following data:"),console.log("Date Created: "+c.dateCreated),console.log("Date accessed"+c.dateAccessed),console.log("Data: "+c.data),i(a,o.message_type.RENEW,o.message_origin.BACKGROUND,o.message_destination.CONTENT,{},null)})}}}else e.from===o.message_origin.CONTENT&&e.type===o.message_type.FINISHED&&r.SyncStorage.get(KEY_ALL_LISTINGS).then(e=>{null!=e&&e.data.length>1&&i(a,o.message_type.RENEW,o.message_origin.BACKGROUND,o.message_destination.CONTENT,{},null)})})),chrome.tabs.onUpdated.addListener(a),chrome.tabs.onHighlighted.addListener(a),chrome.tabs.onActivated.addListener(a),chrome.tabs.onActiveChanged.addListener(a)}]);