/*!
 * @license
 *  - This file is part of Craigslist Helper chrome extension
 *  - Copyright (C) 2020 DaniS Software
 *  - Chrome Extension to update and repost expired Craigslist listing in bulk
 * 
 */!function(e){var t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(i,s,function(t){return e[t]}.bind(null,s));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t,n){"use strict";n.r(t),n.d(t,"STORAGE_KEYS",(function(){return i})),n.d(t,"SAVED_PARAMS",(function(){return s})),n.d(t,"message_origin",(function(){return o})),n.d(t,"message_destination",(function(){return r})),n.d(t,"message_type",(function(){return l})),n.d(t,"isProduction",(function(){return c})),n.d(t,"isNotProduction",(function(){return a})),n.d(t,"outputDebugLog",(function(){return _}));const i=Object.freeze({KEY_ALL_LISTINGS:"craigslist_relister_renew_listings",KEY_NEVERSHOW_LISTINGS:"craigslist_relister_nevershow_listings",KEY_CURRENT_LISTING:"craigslist_relister_current_listing",KEY_COMPLETED_POSTING:"craigslist_relister_completed_posting",KEY_LAST_ERROR_DELAY_USED:"craigslist_relister_last_error_delay_used",KEY_PARAMS:"craigslist_relister_params",LOG_ROLLING:"craigslist_log_rolling"}),s=Object.freeze({SHOW_DELETED_LISTINGS:"bShowDeletedListings",INITIAL_REQUEST:"bInitial"});var o={POPUP:"popup",BACKGROUND:"background",CONTENT:"content_script"},r={CONTENT:"content",BACKGROUND:"background"};const l={RENEW:"renew_listing",GET_LISTINGS:"get_listings",GET_ALL_LISTINGS:"get_all_listings",GET_NEVER_SHOW:"get_nevershow_listings",CLEAR_NEVER_SHOW_LISTINGS:"clear_nevershown_listings",RESET_AND_INTERRUPT_POSTER:"reset_and_interput_poster",REPROCESS_LISTINGS:"reprocess_listings",INITIAL_POPUP_LISTINGS:"initial_popup_listings"};function c(){return!0}function a(){return!1}function _(e){0}},,,,function(e,t,n){const i=Object.freeze({CHECKBOX_INCLUDE_DELETED:"#chkShowDeleted",LBL_INCLUDE_DELETED:"#lblShowDeleted"});var s=n(0),o=s.outputDebugLog;function r(e){var t,n;o("function: processResponse()"),e,_(e)&&(o("received message from content script: "),o(e),o(typeof e),_(e.params)&&(t=e.params,n=t,o("Begin applySavedSettings func"),_(n[s.SAVED_PARAMS.SHOW_DELETED_LISTINGS])&&n[s.SAVED_PARAMS.SHOW_DELETED_LISTINGS]&&(o("Outputting params:"),o(n),$(i.CHECKBOX_INCLUDE_DELETED).prop("checked",!0))),_(e.listings)&&Object.keys(e.listings).length>0?function(e){var t;o("function showListings(): BEGIN"),chrome.tabs.query({active:!0,currentWindow:!0},e=>{t=e[0].id});var n="";n='<table height="80%" width="500px" border="1">',console.log(e),console.log(typeof e);var i=["#e1e3fa","#ffffff"],r=0,_=!1;for(var g in e)e.hasOwnProperty(g)&&(0==_&&(_=!0,n+="<tr height=\"5%\" class='header'>",n+='<th><input type="checkbox" id="checkall_items_renew" name="checkall_renew" class="listing_control" value="checkall"><label for=\'checkall_items_renew\'>Renew</label></th>',n+='<th class="listing_control">Name of the listing</th>',n+='<th><input type="checkbox" id="checkall_items_nevershow" name="checkall_nevershow" class="listing_control" value="checkall"><label for=\'checkall_items_nevershow\'>Never show</label></th>',n+="</tr>",r=++r%i.length),console.log(g+":"+e[g]),n+='<tr id="0_listing">',n+=`<td class="col_renew_check" bgcolor="${i[r]}"><input type="checkbox" name="item_renew" class="listing_renew" value="${g}"></td>`,n+=`<td class="listing_title" bgcolor="${i[r]}">${e[g].title}</td>`,n+=`<td bgcolor="${i[r]}"><input type="checkbox" name="item_nevershow" class="listing_nevershow" value="${g}"></td>`,n+="</tr>",r=++r%i.length);n+="</table>",n+='<p><input type="button" id="btnSubmit" value="Submit"></input>',c(n+='<input type="button" id="btnClearNeverShown" value="Reset never shown items"></input></p>'),u(!1);var h=new Array,d=new Array;$(".listing_nevershow").on("change",(function(){var e=$(this).prop("checked"),t=$(this).parent().parent();t.find(".listing_renew").prop("disabled",e),e?(t.find(".listing_renew").prop("checked",!1),t.addClass("nevershow")):t.removeClass("nevershow")})),$("#checkall_items_renew").on("change",(function(){var e=$("#checkall_items_renew").prop("checked");console.log("Global Action: "+e),$("input:checkbox.listing_renew").each((function(){$(this).prop("checked",e)}))})),$("#checkall_items_nevershow").on("change",(function(){var e=$("#checkall_items_nevershow").prop("checked");$("#checkall_items_renew").prop("checked",!1),$("#checkall_items_renew").prop("disabled",e),console.log("Global Action: "+e),$("input:checkbox.listing_nevershow").each((function(){$(this).prop("checked",e);var t=$(this).parent().parent();t.find(".listing_renew").prop("disabled",e),e?(t.find(".listing_renew").prop("checked",!1),t.addClass("nevershow")):t.removeClass("nevershow")}))})),$("#btnClearNeverShown").click(()=>{a(s.message_type.CLEAR_NEVER_SHOW_LISTINGS,s.message_origin.POPUP,s.message_destination.BACKGROUND,null,null)}),$("#btnSubmit").click(()=>{h.length=0,d.length=0,h=l("input:checkbox.listing_renew",e),d=l("input:checkbox.listing_nevershow",e),(h.length>0||d.length>0)&&(console.log("sending a message to BACKGROUND from POPUP with RENEW subject"),console.log("There are "+h.length+" items in aUrls array"),h.length>0?a(s.message_type.RENEW,s.message_origin.POPUP,s.message_destination.BACKGROUND,{active_tab:t,payload:{renew:h,nevershow:d}},null):d.length>0&&a(s.message_type.REPROCESS_LISTINGS,s.message_origin.POPUP,s.message_destination.BACKGROUND,{active_tab:t,payload:{renew:h,nevershow:d}},null))})}(e.listings):function(){o("function showNoListings(): BEGIN");var e="";e+="<div><b>No listings found!</b></div>",e+="<div><p>Only expired listings that were not deleted previously are shown by default. Please note that sometimes the status may show the listings as expired even though it was also deleted afterward.",e+="<p>You can use the checkbox below to force showing the previously deleted listings</p></p></div>",c(e+='<input type="button" id="btnResetEverything" value="Reset Craigslist reposter"></input>'),u(!1),$("#btnResetEverything").click(()=>{console.log("sending RESET_AND_INTERRUPT_POSTER message to background"),a(s.message_type.RESET_AND_INTERRUPT_POSTER,s.message_origin.POPUP,s.message_destination.BACKGROUND,null,null)})}())}function l(e,t){var n=[];return $(e).each((function(){if(this.checked){var e=$(this).val(),i=$(this).parent().html();console.log("Parent: "+i),console.log("Checkbox checked for value: "+e),n.push(t[e])}})),n}function c(e){$("#content_container").empty(),o("Appending content to the container: #content_container"),$(e).appendTo("#content_container")}function a(e,t,n,i,o,r){n==s.message_destination.BACKGROUND?chrome.runtime.sendMessage({from:t,to:n,type:e,value:i},o):n==s.message_destination.CONTENT&&function(e,t,n,i,s,o){chrome.tabs.query({active:!0,currentWindow:!0},r=>{var l=r[0];_(l)&&(l.url.search(/((http)(s)?:\/\/)?(accounts|post).craigslist.org\/.*/)>-1?chrome.tabs.sendMessage(l.id,{from:t,to:n,type:e,value:i},s):_(o)&&o())})}(e,t,n,i,o,r)}function _(e){return!(void 0===e||!e)}function u(e=!0){e?$("#loading_image").show("medium"):$("#loading_image").hide("slow")}function g(){window.close()}window.addEventListener("DOMContentLoaded",(function(){console.log("initiating event listener"),function(e,t=!1){let n=s.message_type.GET_LISTINGS;e?n=s.message_type.INITIAL_POPUP_LISTINGS:t&&(n=s.message_type.GET_ALL_LISTINGS);a(n,s.message_origin.POPUP,s.message_destination.CONTENT,{},r,g)}(!0),$(i.CHECKBOX_INCLUDE_DELETED).on("change",(function(){var e=$(i.CHECKBOX_INCLUDE_DELETED).prop("checked");o("Hide/Show deleted listings clicked.  Sending out the message to get new listings."),e?a(s.message_type.GET_ALL_LISTINGS,s.message_origin.POPUP,s.message_destination.CONTENT,{[s.SAVED_PARAMS.SHOW_DELETED_LISTINGS]:!0},r,null):a(s.message_type.GET_LISTINGS,s.message_origin.POPUP,s.message_destination.CONTENT,{[s.SAVED_PARAMS.SHOW_DELETED_LISTING]:!1},r,null)}))}))}]);