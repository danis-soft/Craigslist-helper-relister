var e=require("./common_defs.js");function n(n){var s;n,console.log("received message from content script: "),void 0!==n&&null!=n&&(console.log(n),console.log(typeof n)),void 0!==n&&null!=n&&Object.keys(n).length>0?function(n){var s;chrome.tabs.query({active:!0,currentWindow:!0},(e=>{s=e[0].id}));var c="";c='<table width="500px" border="1">',console.log(n),console.log(typeof n);var a=["#e1e3fa","#ffffff"],r=0,h=!1,g=0;for(var d in n)n.hasOwnProperty(d)&&(0==h&&(h=!0,c+="<tr class='header'>",c+='<th><input type="checkbox" id="checkall_items_renew" name="checkall_renew" class="listing_control" value="checkall">Renew</th>',c+='<th class="listing_control">Name of the listing</th>',c+='<th><input type="checkbox" id="checkall_items_nevershow" name="checkall_nevershow" class="listing_control" value="checkall">Never show</th>',c+="</tr>",r=++r%a.length),console.log(d+":"+n[d]),c+=`<tr id="${g}_listing">`,c+=`<td class="col_renew_check" bgcolor="${a[r]}"><input type="checkbox" name="item_renew" class="listing_renew" value="${d}"></td>`,c+=`<td class="listing_title" bgcolor="${a[r]}">${n[d].title}</td>`,c+=`<td bgcolor="${a[r]}"><input type="checkbox" name="item_nevershow" class="listing_nevershow" value="${d}"></td>`,c+="</tr>",r=++r%a.length);c+="</table>",c+='<p><input type="button" id="btnSubmit" value="Submit"></input>',o(c+='<input type="button" id="btnClearNeverShown" value="Reset never shown items"></input></p>'),l(!1);var p=new Array,_=new Array;$(".listing_nevershow").on("change",(function(){var e=$(this).prop("checked"),n=$(this).parent().parent();n.find(".listing_renew").prop("disabled",e),e?(n.find(".listing_renew").prop("checked",!1),n.addClass("nevershow")):n.removeClass("nevershow")})),$("#checkall_items_renew").on("change",(function(){var e=$("#checkall_items_renew").prop("checked");console.log("Global Action: "+e),$("input:checkbox.listing_renew").each((function(){$(this).prop("checked",e)}))})),$("#checkall_items_nevershow").on("change",(function(){var e=$("#checkall_items_nevershow").prop("checked");$("#checkall_items_renew").prop("checked",!1),$("#checkall_items_renew").prop("disabled",e),console.log("Global Action: "+e),$("input:checkbox.listing_nevershow").each((function(){$(this).prop("checked",e);var n=$(this).parent().parent();n.find(".listing_renew").prop("disabled",e),e?(n.find(".listing_renew").prop("checked",!1),n.addClass("nevershow")):n.removeClass("nevershow")}))})),$("#btnClearNeverShown").click((()=>{i(e.message_type.CLEAR_NEVER_SHOW_LISTINGS,e.message_origin.POPUP,e.message_destination.BACKGROUND,null,null)})),$("#btnSubmit").click((()=>{p.length=0,_.length=0,p=t("input:checkbox.listing_renew",n),_=t("input:checkbox.listing_nevershow",n),(p.length>0||_.length>0)&&(console.log("sending a message to BACKGROUND from POPUP with RENEW subject"),console.log("There are "+p.length+" items in aUrls array"),p.length>0?i(e.message_type.RENEW,e.message_origin.POPUP,e.message_destination.BACKGROUND,{active_tab:s,payload:{renew:p,nevershow:_}},null):_.length>0&&i(e.message_type.REPROCESS_LISTINGS,e.message_origin.POPUP,e.message_destination.BACKGROUND,{active_tab:s,payload:{renew:p,nevershow:_}},null))}))}(n):(s="",s+="<div><b>No listings found!</b></div>",o(s+='<input type="button" id="btnResetEverything" value="Reset Craigslist reposter"></input>'),l(!1),$("#btnResetEverything").click((()=>{console.log("sending RESET_AND_INTERRUPT_POSTER message to background"),i(e.message_type.RESET_AND_INTERRUPT_POSTER,e.message_origin.POPUP,e.message_destination.BACKGROUND,null,null)})))}function t(e,n){var t=[];return $(e).each((function(){if(this.checked){var e=$(this).val(),o=$(this).parent().html();console.log("Parent: "+o),console.log("Checkbox checked for value: "+e),t.push(n[e])}})),t}function o(e){$(e).appendTo("#content_container")}function i(e,n,t,o,i){chrome.runtime.sendMessage({from:n,to:t,type:e,value:o},i)}function s(e){return!(void 0===e||!e)}function l(e=!0){e?$("#loading_image").show("medium"):$("#loading_image").hide("slow")}function c(){window.close()}window.addEventListener("DOMContentLoaded",(function(){var t,o,i,l,a,r;console.log("initiating event listener"),t=e.message_type.GET_LISTINGS,o=e.message_origin.POPUP,i=e.message_destination.CONTENT,l="",a=n,r=c,chrome.tabs.query({active:!0,currentWindow:!0},(e=>{var n=e[0];s(n)&&(n.url.search(/((http)(s)?:\/\/)?(accounts|post).craigslist.org\/.*/)>-1?chrome.tabs.sendMessage(n.id,{from:o,to:i,type:t,value:l},a):s(r)&&r())}))}));