var e=function(e,t){return new Promise(((o,n)=>{t||n("Error: No value specified");var i=new Object;i[e]=t,chrome.storage.local.set(i,(function(){console.log("We have saved all the settings!!! WohOOO"),o("Settings saved")}))}))},t=function(e){return new Promise(((t,o)=>{chrome.storage.local.get(e,(function(o){t(o[e])}))}))},o=function(e){return new Promise(((t,o)=>{chrome.storage.local.remove(e,(()=>{t()}))}))};console.log("Craigslist_helper: + running_content_script");var n="popup",i="background",a="content",l="renew_listing",s="get_listings",r="craigslist_relister_renew_listings",c="craigslist_relister_current_listing",d="craigslist_relister_completed_posting";window.onload=function(){window.jQuery};var g=/accounts.craigslist.org\/login\/home/,u=/post.craigslist.org\/.*?s=edit$/,h=/post.craigslist.org\/.*?s=preview$/,p=/post.craigslist.org\/k\/.*/;String.prototype.isMatched=function(e){return this.search(e)>-1},console.log(g);var m=document.URL.trim(),f=new Object,w="active",_="expired",x="deleted";async function v(){console.log("Detected document is ready.  Attempting to determine the mode according to the document URL"),console.log("Document URL: "+m),m.isMatched(g)?mapActivePosts=async function(){let e=null,n=null;if(e=await b(),n=await M(),R(e)&&R(n))console.log("Detected oAllListings && oCurrentListing were defined and not null"),console.log("oCurrentListing.index: "+n.index+" | oAllListings.data.length: "+e.data.length),console.log("oAllListings.data[oCurrentListing.index].repost_url: "+e.data[n.index].repost_url+" == "+n.data.repost_url),n.index<e.data.length&&e.data[n.index].repost_url==n.data.repost_url?(console.log("Detected from storage that we have other outstanding listing to post."),T(e,n)):(console.log("ERROR: Either current listing is out of bounds or current listing data does not match all listing data."),console.log("oCurrentListing.index: "+n.index+" | Repost URLS: "+e.data[n.index].repost_url+" == "+n.data.repost_url),L());else{R(await t(d))&&(await o(d),bootbox.alert("The posting of all the listings has been completed.")),console.log("No other listing detected in storage.  Parsing listings"),C()}}():m.isMatched(u)?E($("input#PostingTitle").val()).then((e=>{e&&$("form#postingForm").submit()})):m.isMatched(h)?E($("#titletextonly").html()).then((t=>{t&&y(async function(){var t=await M(),o=2e3,n=2e4,i=1;return i=t.numberOfRepostTries++,S(t.dateCreated)&&(i>1&&(o=Math.floor(Math.random()*(n*(.1*i)))),await e(c,t)),o}()).then($("form#publish_top").submit())})):m.isMatched(p)&&$("h4:contains('Thanks for posting!')").text().trim().toLowerCase()=="Thanks for posting! We really appreciate it!".toLowerCase()&&async function(){let t=null,o=null;t=await b(),o=await M();var n=!0;R(t)&&R(o)&&(o.index++,o.index<t.data.length?(n=!1,o.data=t.data[o.index],console.log("Saving KEY_CURRENT_LISTING entry"),await e(c,o)):(o.index--,await e(d,o)));n&&(console.log("--------------------------------------"),console.log("ERROR: Fourth mode error. Printing additional data:"),console.log(" Current index: "+o.index+" |  All listings length: "+t.data.length),console.log(o),console.log("--------------------------------------"),L());await y(2e3),U("https://accounts.craigslist.org/login/home")}()}function L(){console.log("Deleting KEY_ALL_LISTINGS and KEY_CURRENT_LISTING"),Promise.allSettled([o(r),o(c)])}function R(e){return!(void 0===e||!e)}function C(){t(r).then((e=>{var t=new Array;R(e)&&(t=e.payload.nevershow),C(t)}))}function C(e){var t=new Map,o=new Map;console.log("Detected dictModes.first mode");console.log("Craigslist_helper: adding parameters to dictionary");var n="",i=(new Map,""),a="",l="",s="",r="",c=-1;return $("tr.posting-row").each((function(){var d,g;c=-1,n=$(this).children("td.title").text().trim(),i=n.replace(/[\r\n]/gm,"").replace(/[ ]{2,}/g," "),c=i.lastIndexOf("-"),a=c>0&&i.substr(c,i.length).isMatched(/-[ ]*\$[ ]*\d{1,6}$/)?i.substr(0,c):i,console.log("parsed text: "+i),console.log("key text: "+a),console.log(""+$(this).children("td.status").text().trim().toLowerCase().search("active")),(s=$(this).children("td.status").text().trim().toLowerCase()).isMatched(w)?0==t.has(a)&&t.set(a,i):s.isMatched(x)?0==o.has(a)&&o.set(a,i):s.isMatched(_)&&(l=$(this).children("td.buttons.expired").find("form.manage.display").attr("action"),l+="?action=repost",console.log("raw text: "+n),console.log("URL: "+l),console.log("=============================================="),console.log("")),d=/(['"])/g,g="",r=i.replace(d,g),0!=t.has(a)||0!=o.has(a)||r in f||null!=e&&0!=e.includes(l)||(f[r]={title:i,repost_url:l,title_no_price:a})})),console.log(""),console.log("Printing out mapExpired"),console.log(f),console.log("Printing out mapActive"),console.log(t),console.log(document.URL),console.log("================================"),console.log("================================"),console.log("================================"),console.log("================================"),t}function y(e){return function(e){return new Promise((t=>setTimeout(t,e)))}(e)}async function M(){return await t(c)}async function b(){return await t(r)}async function E(e){var t,o,n=await M();return R(n)&&console.log("func isContinueRepost | oData.dateCreated: "+n.dateCreated+" | stringSource="+e+", title_no_price = "+n.data.title_no_price),R(n)&&S(n.dateCreated)&&(t=e,o=n.data.title_no_price,R(t)&&R(o)&&t.trim().toLowerCase()==o.trim().toLowerCase())?(console.log("Going along with reposting"),!0):(console.log("WARNING: Reposting failed either due to dateCreated or string match fail."),!1)}function S(e){let t=null,o=null;return t=Date.now(),o=Math.floor((t-e)/1e3)/3600,o<=3}async function T(t=null,o=null){if(console.log("Function invoked: renewListings()"),null==t&&(t=await b()),null==o&&(o=await M()),R(t)&&0==S(t.dateCreated))console.log("ERROR: function renewListings. Either oAllListings is null or dateCreated = false"),L();else{let n=0;if(0==R(o)&&(console.log("Detected current listing does not exist.  Creating new current listing with index 0"),o={dateCreated:Date.now(),dateLastUpdated:Date.now(),numberOfRepostTries:0,index:n,data:t.data[n]}),R(t.data[o.index])&&R(o.data)&&t.data[o.index].repost_url==o.data.repost_url){let t=o.data.repost_url;console.log("element title: "+o.data.title),console.log("trying to go to URL: "+o.data.repost_url),console.log("Saving KEY_CURRENT_LISTING entry"),await e(c,o),U(t)}else console.log("Error URLS do not match.  Cleaning out the Keys for current listing and all the listings"),L()}}function U(e){window.location.href=e}$(document).ready((()=>{v()})),chrome.runtime.onMessage.addListener((function(e,t,o){console.log("Received message"),e.from===n&&e.to===a?(console.log("Received message from popup"),e.type===s?(console.log("Received request or data from popup.  Sending in data"),console.log(f),o(f)):e.type===l&&T()):e.from==i&&e.type===l&&T()}));